{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/mypage.css' %}">
{% endblock %}

{% block content %}
<main class="mypage">
  <!-- Profile -->
  <section class="profile">
    <div class="avatar">ğŸ‘¤</div>
    <h1 class="name">{{ user.name }}</h1>
    <p class="subtitle">èµ·å‹•ã‚’ç¶šã‘ã¦ã„ã‚‹ä»²é–“</p>
  </section>

  <!-- Stats -->
  <section class="stats-grid">
    <div class="stat-card stat-purple">
      <p class="label">ä¿æœ‰ãƒã‚±ãƒƒãƒˆ</p>
      <p class="value">{{ user.tickets }}</p>
    </div>
    <div class="stat-card stat-green">
      <p class="label">ç´¯è¨ˆé”æˆ</p>
      <p class="value">{{ user.total_achievements }}</p>
    </div>
  </section>

  <!-- Weekly progress -->
  <section class="card weekly">
    <div class="card-header">
      <h2>ä»Šé€±ã®é€²æ—</h2>
      <span class="week">Week 3/4</span>
    </div>

    <div class="progress-row">
      <span>ã‚ãªãŸã®é”æˆç‡</span>
      <span>{{ weekly.my_achievements }}/{{ weekly.my_reservations }}
        ({{ weekly.progress_percent }}%)</span>
    </div>
    <div class="progress-bar">
      <div class="progress-fill" style="width: {{ weekly.progress_percent }}%"></div>
    </div>

    <div class="notice notice-gold">
      ğŸ… ãƒãƒ¼ãƒ å®Œå…¨é”æˆé€±<br>
      <span>1é€±é€£ç¶šã§å…¨å“¡é”æˆä¸­ï¼</span>
    </div>
    <div class="notice notice-purple">
      ğŸ’ª ä»Šé€±å…¨å“¡ãŒé”æˆã™ã‚Œã°ã€å…¨å“¡ã«+1ãƒã‚±ãƒƒãƒˆç²å¾—ã®ãƒãƒ£ãƒ³ã‚¹ï¼
    </div>
  </section>

  <!-- Recovery -->
  <section class="card recovery">
    <div class="recovery-header">
      <h2>æ•‘æ¸ˆï¼ˆãƒªã‚«ãƒãƒªãƒ¼ï¼‰</h2>
      <span class="recovery-status {{ user.recovery_available|yesno:'ok,ng' }}">
        {{ user.recovery_available|yesno:'åˆ©ç”¨å¯èƒ½,åˆ©ç”¨ä¸å¯' }}
      </span>
    </div>
    <p class="muted">é€±1å›ã®æ•‘æ¸ˆæ©Ÿèƒ½</p>
    <p class="muted">æ²¡åå›é¿ã®ã¿ï¼ˆãƒœãƒ¼ãƒŠã‚¹ãªã—ï¼‰</p>
    {% if user.recovery_available %}
    <form method="post" action="{% url 'reservation_recovery' user.recovery_target_id %}" class="recovery-actions right">
        {% csrf_token %}
        <button class="btn btn-danger" type="submit">ãƒªã‚«ãƒãƒªãƒ¼ã‚’ä½¿ã†</button>
    </form>
    {% else %}
    <div class="recovery-actions left">
        <button class="btn btn-ghost" disabled>ãƒªã‚«ãƒãƒªãƒ¼ä¸å¯</button>
    </div>
    {% endif %}


  </section>

  <section class="card actions">
    <form action="{% url 'logout' %}" method="post">
      {% csrf_token %}
      <button type="button" onclick="logout()" class="btn btn-danger">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    </form>
  </section>  
</main>
{% endblock %}
