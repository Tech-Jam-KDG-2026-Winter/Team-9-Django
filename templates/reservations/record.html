{% extends 'base.html' %}
{% block content %}
<div class="dashboard">
  <div class="reserve-action card-container">
    <h1 class="gradient-text">å®Œäº†</h1>
    <form id="recordForm" method="post" class="custom-form">
      {% csrf_token %}
      <div class="form-group">
        <label>ç¨®åˆ¥ï¼ˆå¿…é ˆï¼‰</label>
        {{ form.activity_type }}
      </div>
      <div class="form-group">
        <label>ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
        {{ form.memo }}
      </div>
      <div class="form-check">
        <label>{{ form.share_detail }} <span>è©³ç´°ã‚’ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ã«æŠ•ç¨¿</span></label>
      </div>
      <button type="button" id="openFinishModal" class="reserve-btn full-width">å®Œäº†ã™ã‚‹</button>
    </form>
  </div>
</div>

<div id="finishModal" class="modal" style="display: none;">
  <div class="modal-content">
    <h2 class="gradient-text">ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼</h2>
    <div class="modal-icon-wrapper">
      <div class="play-icon-circle"><span style="font-size:40px">ğŸ‰</span></div>
    </div>
    <p>ãƒŠã‚¤ã‚¹ãƒ¯ãƒ¼ã‚¯ã‚¢ã‚¦ãƒˆï¼<br><small>ä»Šæ—¥ã®åŠªåŠ›ã‚’ä¿å­˜ã—ã¦çµ‚äº†ã—ã¾ã™ã‹ï¼Ÿ</small></p>
    <div class="modal-actions">
      <button id="submitFormBtn" class="reserve-btn full-width">ä¿å­˜ã—ã¦çµ‚äº†</button>
      <button type="button" id="closeFinishModal" class="btn-link">å…¥åŠ›ã‚’ç›´ã™</button>
    </div>
  </div>
</div>

<script>
  window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const timeSpent = urlParams.get('time');
    const memoField = document.querySelector('textarea[name="memo"]');
    if (timeSpent && memoField) memoField.value = `é‹å‹•æ™‚é–“ï¼š${timeSpent}\n` + (memoField.value || "");

    const modal = document.getElementById('finishModal');
    document.getElementById('openFinishModal').onclick = () => modal.style.display = 'flex';
    document.getElementById('closeFinishModal').onclick = () => modal.style.display = 'none';
    document.getElementById('submitFormBtn').onclick = () => document.getElementById('recordForm').submit();
  });
</script>
{% endblock %}